(()=>{"use strict";class e{constructor(e,t,s,n){this.templateElement=document.getElementById(e),this.hostElement=document.getElementById(t);const i=document.importNode(this.templateElement.content,!0);this.element=i.firstElementChild,n&&(this.element.id=n),this.attach(s)}attach(e){this.hostElement.insertAdjacentElement(e?"beforebegin":"beforeend",this.element)}}var t;!function(e){e[e.Active=0]="Active",e[e.Finished=1]="Finished"}(t||(t={}));class s{constructor(e,t,s,n,i){this.id=e,this.task=t,this.description=s,this.date=n,this.status=i}}class n{constructor(){this.modalElement=document.querySelector("#modal"),this.taskElement=this.modalElement.querySelector("h2"),this.descriptionElement=this.modalElement.querySelector("h3"),this.dateElement=this.modalElement.querySelector("p"),this.closeButton=null}configure(){this.closeButton=this.modalElement.querySelector(".btn-close"),this.closeButton&&this.closeButton.addEventListener("click",this.close.bind(this))}open(){this.modalElement.style.display="block",this.configure()}close(){this.modalElement.style.display="none"}showTask(e){this.taskElement.textContent=e.task,this.descriptionElement.textContent=e.description,this.dateElement.textContent=e.date}}class i{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}}class r extends i{constructor(){super(),this.tasks=[],this.modal=new n}static getInstance(){return this.instance||(this.instance=new r),this.instance}addTask(e,n,i){const r=new s(Math.random().toString(),e,n,i,t.Active);this.tasks.push(r),this.updateListeners(),this.saveTasksToLocalStorage()}removeTask(e){const t=this.tasks.findIndex((t=>t.id===e));-1!==t&&(this.tasks.splice(t,1),this.updateListeners(),this.saveTasksToLocalStorage(),this.modal.close())}moveTask(e,t){const s=this.tasks.find((t=>t.id===e));s&&s.status!==t&&(s.status=t,this.updateListeners(),this.saveTasksToLocalStorage())}initializeTasks(){this.tasks=this.fetchTasksFromLocalStorage(),this.updateListeners()}updateListeners(){for(const e of this.listeners)e(this.tasks.slice())}saveTasksToLocalStorage(){let e=JSON.stringify(this.tasks);localStorage.setItem("data",e)}fetchTasksFromLocalStorage(){const e=localStorage.getItem("data");return e?JSON.parse(e):[]}}const a=r.getInstance();function l(e,t,s){const n=s.value;return{configurable:!0,get(){return n.bind(this)}}}class o extends e{constructor(){super("input-group","app",!1),this.taskInputElement=this.element.querySelector("#task"),this.descriptionInputElement=this.element.querySelector("#description"),this.dateInputElement=this.element.querySelector("#date"),this.configure()}configure(){this.element.addEventListener("submit",this.submitHandler)}renderContent(){}clearInputs(){this.taskInputElement.value="",this.descriptionInputElement.value="",this.dateInputElement.value=""}gatherUserInput(){const e=this.taskInputElement.value,t=this.descriptionInputElement.value,s=this.dateInputElement.value;return 0===e.trim().length||0===t.trim().length||0===s.trim().length?void alert("入力値が正しくありません。"):[e,t,s]}submitHandler(e){e.preventDefault();const t=this.gatherUserInput();if(Array.isArray(t)){const[e,s,n]=t;a.addTask(e,s,n),this.clearInputs()}}}!function(e,t,s,n){var i,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,s,a):i(t,s))||a);r>3&&a&&Object.defineProperty(t,s,a)}([l],o.prototype,"submitHandler",null);var d=function(e,t,s,n){var i,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,s,a):i(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a};class c extends e{constructor(e,t){super("single-task",e,!1,t.id),this.task=t,this.modal=new n,this.templateElement=document.getElementById("modal-template"),this.configure(),this.renderContent()}dragStartHandler(e){e.dataTransfer.setData("text/plain",this.task.id),e.dataTransfer.effectAllowed="move"}dragEndHandler(e){console.log("Drag end")}clickHandler(){const e=this.templateElement.content.cloneNode(!0),t=e.querySelector("h2"),s=e.querySelector("h3"),n=e.querySelector("p");e.querySelector("#delete-btn").addEventListener("click",this.deleteHandler),t.textContent=this.task.task,s.textContent=`<詳細> ${this.task.description}`,n.textContent=`<完了日> ${this.task.date}`;const i=document.querySelector("#modal");i.innerHTML="",i.appendChild(e),this.modal.open()}configure(){this.element.querySelector("#modal-btn").addEventListener("click",this.clickHandler),this.element.addEventListener("dragstart",this.dragStartHandler),this.element.addEventListener("dragend",this.dragEndHandler)}renderContent(){this.element.querySelector("h2").textContent=this.task.task}deleteHandler(){a.removeTask(this.task.id),this.element.remove()}}d([l],c.prototype,"dragStartHandler",null),d([l],c.prototype,"clickHandler",null),d([l],c.prototype,"deleteHandler",null);var h=function(e,t,s,n){var i,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,s,a):i(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a};class u extends e{constructor(e){super("task-list","app",!0,`${e}-tasks`),this.type=e,this.assignedTasks=[],this.configure(),this.renderContent(),this.initializeTasks()}dragOverHandler(e){e.dataTransfer&&"text/plain"===e.dataTransfer.types[0]&&(e.preventDefault(),this.element.querySelector("ul").classList.add("droppable"))}dropHandler(e){const s=e.dataTransfer.getData("text/plain");a.moveTask(s,"active"===this.type?t.Active:t.Finished)}dragLeaveHandler(e){this.element.querySelector("ul").classList.remove("droppable")}configure(){this.element.addEventListener("dragover",this.dragOverHandler),this.element.addEventListener("drop",this.dropHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),a.addListener((e=>{const s=e.filter((e=>"active"===this.type?e.status===t.Active:e.status===t.Finished));this.assignedTasks=s,this.renderTasks()}))}renderContent(){const e=`${this.type}-tasks-list`;this.element.querySelector("ul").id=e,this.element.querySelector("h2").textContent="active"===this.type?"実行中のタスク":"完了済みタスク"}renderTasks(){const e=document.getElementById(`${this.type}-tasks-list`);e.innerHTML="";for(const t of this.assignedTasks)new c(e.id,t)}initializeTasks(){"active"!==this.type&&"finished"!==this.type||a.initializeTasks()}}h([l],u.prototype,"dragOverHandler",null),h([l],u.prototype,"dropHandler",null),h([l],u.prototype,"dragLeaveHandler",null),new o,new u("active"),new u("finished")})();